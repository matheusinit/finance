<div class="mx-auto max-w-screen-xl">
  <div class="mt-10 rounded-md border border-gray-200">
    <div class="flex w-full items-center justify-between px-6 pb-3 pt-3">
      <div class="flex items-baseline space-x-2">
        <h4 class="font-bold text-gray-800">
          <%= @receipt.name %>
        </h4>
        <div class="inline-flex rounded-2xl bg-purple-100 px-2 py-1 text-xs font-bold text-purple-500">
          <% if @incomes.count == 1 %>
            <%= @incomes.count %> item
          <% end %>

          <% if @incomes.count != 1 %>
            <%= @incomes.count %> itens
          <% end %>
        </div>
      </div>
    
      <div class="flex space-x-2">
        <%= link_to "/receipt/#{@receipt.id}/income/new", class: "flex items-center text-sm rounded-md bg-green-600 text-white space-x-1 fill-white px-1.5 py-1 shadow hover:bg-green-700 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-green-800" do %>
          <%= inline_svg_tag "plus.svg", class: 'size-4' %>

          <span>Ganho</span>
        <% end %>

        <%= link_to "/receipt/#{@receipt.id}/expense/new", class: "flex items-center text-sm rounded-md bg-red-600 text-white space-x-1 fill-white px-1.5 py-1 shadow hover:bg-red-700 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-red-800" do %>
          <%= inline_svg_tag "plus.svg", class: 'size-4' %>

          <span>Despesa</span>
        <% end %>
      </div>
    </div>
    
    <div class="flex flex-col space-y-1 border-t px-6 pb-3 pt-3">
      <div class="text-sm text-gray-700">
        <span class="font-semibold text-gray-600">
          Mês/Ano: 
        </span>
        <span>
          <%= l(@receipt.created_at, format: "%B/%Y") %>
        </span>
      </div>

      <div class="text-sm text-gray-700">
        <span class="font-semibold text-gray-600">
          Última atualização: 
        </span>
        <span>
          <%= l(@receipt.created_at, format: "%d/%m/%Y") %>
        </span>
      </div>

      <% if @expenses.count == 0 %>
        <div class="text-gray-700 text-sm flex items-center space-x-1">
          <%= inline_svg "expense.svg", class: 'fill-red-600 size-5 stroke-1' %>
          <span>
            Não há despesas cadastradas
          </span>
        </div>
      <% end %>

      <% if @incomes.count == 0 %>
        <div class="text-gray-700 text-sm flex items-center space-x-1">
          <%= inline_svg "income.svg", class: 'fill-green-600 size-5 stroke-1' %>
          <span>
            Não há ganhos cadastrados
          </span>
        </div>
      <% end %>
    </div>

    <% if @incomes.count > 0 %>
      <%= render "components/table/self" do %>
        <%= render "components/table/table_header" do %>
          <th scope="col" class="px-6 py-3 w-4/12">Nome</th>
          <th scope="col" class="px-6 py-3 w-2/12">Tipo</th>
          <th scope="col" class="px-6 py-3 w-2/12">Valor</th>
          <th scope="col" class="px-6 py-3 w-2/12">Recorrente mensalmente</th>
          <th scope="col" class="px-6 py-3 w-1/12">Pago</th>
          <th class="pr-6 py-1 pl-1 w-1/12"></th>
        <% end %>
        <%= render "components/table/table_body" do %>
          <% @incomes.each do |income| %>
            <%= render "components/table/table_item" do %>
              <%= render "components/table/table_cell" do %>
                <%= income.name %>
              <% end %>

              <%= render "components/table/table_cell" do %>
                Ganho
              <% end %>

              <%= render "components/table/table_cell" do %>
                R$ <%= income.value %>
              <% end %>

              <%= render "components/table/table_cell" do %>
                <%= income.is_monthly_recurring == true ? "Sim" : "Não" %>
              <% end %>

              <%= render "components/table/table_cell" do %>
                <%= income.is_paid == true ? "Sim" : "Não" %>
              <% end %>

              <td class="pr-6 pl-1 py-1">
                <div class="flex justify-end relative" data-controller="dropdown">
                  <button class="px-1 py-1 hover:bg-gray-100 transition rounded"  data-action="click->dropdown#toggle">
                    <%= inline_svg "ellipsis.svg", class: 'w-6 h-6 stroke-gray-800' %>
                  </button>

                  <div class="hidden absolute z-50 right-0 top-8 mt-2 w-56 origin-top-right rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none" role="menu" aria-orientation="vertical" aria-labelledby="menu-button" tabindex="-1" data-dropdown-target="dropdown">
                    <div class="py-1" role="none">
                      <%= button_to "/income/#{income.id}/payment", class: "flex space-x-1 items-center text-left w-full text-gray-700 block px-4 py-2 text-sm hover:bg-gray-100", method: :put, role: "menuitem", tabindex: "-1" do %>
                        <%= inline_svg "check.svg", class: 'w-5 h-5 stroke-green-600' %>
                        <span>Marcar como pago</span>
                      <% end %>
                    </div>

                    <div class="py-1" role="none">
                      <%= button_to "/income/#{income.id}", class: "flex space-x-1 items-center text-left w-full text-gray-700 block px-4 py-2 text-sm hover:bg-gray-100", method: :put, role: "menuitem", tabindex: "-1" do %>
                        <%= inline_svg "edit.svg", class: 'w-5 h-5 stroke-blue-600' %>
                        <span>Editar</span>
                      <% end %>
                    </div>

                    <div class="py-1" role="none">
                      <%= button_to "/income/#{income.id}", class: "flex space-x-1 items-center text-left w-full text-gray-700 block px-4 py-2 text-sm hover:bg-gray-100", method: :delete, role: "menuitem", tabindex: "-1" do %>
                        <%= inline_svg "trash.svg", class: 'w-5 h-5 stroke-red-600' %>

                        <span>Remover</span>
                      <% end %>
                    </div>
                  </div>
                </div>
              </td>
            <% end %>
          <% end %>
        <% end %>
      <% end %>
    <% end %>

    <% if @expenses.count > 0 %>
      <%= render "components/table/self" do %>
        <%= render "components/table/table_header" do %>
          <th scope="col" class="px-6 py-3 w-4/12">Nome</th>
          <th scope="col" class="px-6 py-3 w-2/12">Tipo</th>
          <th scope="col" class="px-6 py-3 w-2/12">Valor</th>
          <th scope="col" class="px-6 py-3 w-2/12">Parcelas</th>
          <th scope="col" class="px-6 py-3 w-1/12">Pago</th>
          <th class="pr-6 py-1 pl-1 w-1/12"></th>
        <% end %>
        <%= render "components/table/table_body" do %>
          <% @expenses.each do |expense| %>
            <%= render "components/table/table_item" do %>
              <%= render "components/table/table_cell" do %>
                <%= expense.name %>
              <% end %>

              <%= render "components/table/table_cell" do %>
                Despesa
              <% end %>

              <%= render "components/table/table_cell" do %>
                R$ <%= expense.value %>
              <% end %>

              <%= render "components/table/table_cell" do %>
                <%= expense.installments_number %>
              <% end %>

              <%= render "components/table/table_cell" do %>
                <%= expense.is_paid == true ? "Sim" : "Não" %>
              <% end %>

              <td class="pr-6 pl-1 py-1">
                <div class="flex justify-end relative" data-controller="dropdown">
                  <button class="px-1 py-1 hover:bg-gray-100 transition rounded" data-action="click->dropdown#toggle">
                    <%= inline_svg "ellipsis.svg", class: 'w-6 h-6 stroke-gray-800' %>
                  </button>

                  <div class="hidden absolute right-0 top-8 mt-2 w-56 origin-top-right rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none" role="menu" aria-orientation="vertical" aria-labelledby="menu-button" tabindex="-1" data-dropdown-target="dropdown">
                    <div class="py-1" role="none">
                      <%= button_to "/expense/#{expense.id}/payment", class: "flex space-x-1 items-center text-left w-full text-gray-700 block px-4 py-2 text-sm hover:bg-gray-100", method: :put, role: "menuitem", tabindex: "-1" do %>
                        <%= inline_svg "check.svg", class: 'w-5 h-5 stroke-green-600' %>
                        <span>Marcar como pago</span>
                      <% end %>
                    </div>

                    <div class="py-1" role="none">
                      <%= button_to "/expense/#{expense.id}", class: "flex space-x-1 items-center text-left w-full text-gray-700 block px-4 py-2 text-sm hover:bg-gray-100", method: :put, role: "menuitem", tabindex: "-1" do %>
                        <%= inline_svg "edit.svg", class: 'w-5 h-5 stroke-blue-600' %>
                        <span>Editar</span>
                      <% end %>
                    </div>

                    <div class="py-1" role="none">
                      <%= button_to "/expense/#{expense.id}", class: "flex space-x-1 items-center text-left w-full text-gray-700 block px-4 py-2 text-sm hover:bg-gray-100", method: :delete, role: "menuitem", tabindex: "-1" do %>
                        <%= inline_svg "trash.svg", class: 'w-5 h-5 stroke-red-600' %>
                        <span>Remover</span>
                      <% end %>
                    </div>
                  </div>
                </div>
              </td>
            <% end %>
          <% end %>
        <% end %>
      <% end %>
    <% end %>
  </div>
<div>
